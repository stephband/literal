<head>
    <meta charset="utf-8" />
    <meta name="author" content="Stephen" />
    <meta name="description" content="Documentation for Literal. Literal puts JS into your HTML. Literal defines a custom include element that parses and renders templates written as JS Literals, in a small library under 15kB minified and gzipped." />
    <meta name="viewport" content="width=device-width" />

    <link rel="stylesheet" href="./elements/include-literal.css" />

    <script>
        window.DEBUG = true;
    </script>

    <style>
        [data-before]::before {
            content: attr(data-before);
        }

        .class-before::before {
            content: attr(class);
        }

        :not(:checked) + .unchecked-before::before {
            content: '✔ Input is unchecked'
        }

        :checked + .checked-before::before {
            content: '✔ Input is checked'
        }
    </style>

    <template id="attributes">
        <pre data-before="${ data.attribute }"></pre>
        <pre class="class-before ${ data.class }"></pre>
        <pre hidden="${ data.boolean }">✔ Boolean is false</pre>
        <input type="text" value="${ data.value }" />
        <input type="checkbox" checked="${ data.checked }" />
        <pre class="unchecked-before"></pre>
        <pre>${ data.content }</pre>
    </template>

    <template id="item">
        ${ this.done(() => console.log('STOPPED')), '' }
        <pre>${ this.id + ': ' + this.constructor.name } - ${ data.label }</pre>
    </template>

    <template id="item-list">
        <h3>Test</h3>
        <pre>${ this.id + ': ' + this.constructor.name }</pre>
        ${ data.items.map(include('#item')) }
        <pre>${ this.id + ': ' + this.constructor.name }</pre>
    </template>
</head>

<body>
    <script type="module">
    /*import './elements/include-literal.js';

    const data1 = {
        items: [{
            label: 'One'
        }, {
            label: 'Ting'
        }]
    };

    const data2 = {
        items: [{
            label: 'Two'
        }, {
            label: 'Tang'
        }]
    };

    const element = document.getElementById('element');
    const data = element.data = Object.assign({}, data1);

    setTimeout(() => {
        Object.assign(element.data, data2)
    }, 500);*/




    import tests        from "../fn/modules/test.js";
    import Renderer     from './modules/renderer.js';
    import { Observer } from '../fn/observer/observer.js';

    const keys = Object.keys;
/*
    tests('Renderer', function(test, log) {
        test("Renderer()", function(equals, done) {
            const expected = [
                'Hail ',
                'Hail Bob',
                'Hail Mike',
                'Hail Mary',
                'Hail Ceasar'
            ];

            const renderer = new Renderer('Hail ${ data.x ? data.a : data.b }', (string) =>
                equals(expected.shift(), string)
            );

            const data = Observer({});

            // Hail
            renderer
            .done(() => equals(0, expected.length))
            .push(data);

            Promise
            .resolve()
            .then(() => {
                // Test for keys being observed
                equals(['x', 'b'], keys(renderer.observers));

                // Hail Bob
                data.b = 'Does nothing becuase immediately followed by ...';
                data.b = 'Bob';
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'b'], keys(renderer.observers));

                // Hail Mike
                data.a = 'Mike';
                data.x = true;
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                // Hail Mary
                data.a = 'Mary';
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                // Hail Ceasar
                renderer.push({ x: true, a: 'Ceasar' });
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                // Stop
                renderer.stop();
            })
            .then(() => {
                // Test for keys being observed
                equals([], keys(renderer.observers));

                // Causes error
                renderer.push({ x: false });
            })
            .catch((e) => {
                // Error received
                equals('Error', e.constructor.name);
            })
            .finally(done);
        }, 13);


        test("Renderer() Allow recueing from renderer.push() inside template", function(equals, done) {
            const expected = [
                'Hail ',
                'Hail Mary'
            ];

            const renderer = new Renderer('Hail ${ data.x ? data.a : (this.push({ x: true, a: "Mary" })) }', (string) =>
                equals(expected.shift(), string)
            );

            const data = Observer({ a: 'Mary' });

            // Hail
            renderer
            .done(() => equals(0, expected.length))
            .push(data);

            Promise
            .resolve()
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                renderer.stop();
            })
            .finally(done);
        }, 4);

        test("Renderer() Allow recueing from data.prop = x inside template", function(equals, done) {
            const expected = [
                'Hail true',
                'Hail Mary'
            ];

            const renderer = new Renderer('Hail ${ data.x ? data.a : (data.x = true) }', (string) =>
                equals(expected.shift(), string)
            );

            const data = Observer({ a: 'Mary' });

            // Hail
            renderer
            .done(() => equals(0, expected.length))
            .push(data);

            Promise
            .resolve()
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                renderer.stop();
            })
            .finally(done);
        }, 4);
    });
*/

    import TemplateRenderer from './modules/renderer-template.js';

    tests('TemplateRenderer', function(test, log) {
        test("TemplateRenderer()", function(equals, done) {
            const renderer = new TemplateRenderer('#attributes', document.body);
            const data = { attribute: '✔ Attribute is rendered', class: '✔ Class is rendered', boolean: false, value: '✔ Value is rendered', checked: false, content: '✔ Text is rendered' };
            renderer.push(data);
            document.body.append(renderer.first);

            window.r = renderer;
            window.data = Observer(data);
        }, 0);
    });
    </script>
</body>
