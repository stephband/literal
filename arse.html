<head>
    <meta charset="utf-8" />
    <meta name="author" content="Stephen" />
    <meta name="description" content="Documentation for Literal. Literal puts JS into your HTML. Literal defines a custom include element that parses and renders templates written as JS Literals, in a small library under 15kB minified and gzipped." />
    <meta name="viewport" content="width=device-width" />

    <link rel="stylesheet" href="./elements/include-literal.css" />

    <script>
        window.rangeInputStylesheet = '/form-elements/range-input-shadow.css';
    </script>

    <template id="variation-setting">
        <!--y-input class="@2-hidden" name="variation:${ data.name }" min="${ data.min }"  max="${ data.max }" value="${ typeof data.value === 'number' ? data.value : data.default }" id="variation-${ data.name }-y">
            <span class="font-12">${ data.label }</span>
        </y-input-->

        ${ this.done(() => console.log('STOPPED')) }

        <range-input class="font-11 @2-shown control-range-input" name="variation:${ data.name }" min="${ data.min }"  max="${ data.max }" value="${ typeof data.value === 'number' ? data.value : data.default }" id="variation-${ data.name }-x">
            <span class="font-12">${ data.label }</span>
        </range-input>
    </template>

    <!--template id="variation-preset">
        <option value="${ data.id }">${ data.label }</option>
    </template>

    <template id="variation-feature">
        <input type="checkbox" class="masked" name="feature:${ data.name }" value="1" id="feature-${ data.name }"/>
        <label class="small-pill-button pill-button button white-bg" for="feature-${ data.name }">${ data.label }</label>
    </template-->

    <template id="variation-controls">
        <form>
            ${
                events('input', element).each(overload((e) => e.target.name.replace(/:.*$/, ''), {
                    'variation': (e) => {
                        const name  = e.target.name.replace(/^variation:/, '');
                        data.settings.find(matches({ name })).value = parseFloat(e.target.value);
                    },

                    'feature': (e) => {
                        const name = e.target.name.replace(/^feature:/, '');
                        data.features.find(matches({ name })).value = e.target.checked;
                    },

                    'preset': (e) => {
                        const preset   = data.presets.find(matches({ id: e.target.value }));
                        if (!preset) { return; }

                        const settings = preset.settings;
                        let name;
                        for (name in settings) {
                            data.settings.find(matches({ name })).value = settings[name];
                        }
                    }
                })), ''
            }

            <h3>Controls</h3>

            ${ data.settings.map(include('#variation-setting')) }

            <!--div class="@2-x2">
                <label class="font-12" for="presets-{{instance.pk}}">Presets</label>
                <label for="preset-select-{{instance.pk}}" class="pill-button select-button button">
                    <select name="preset" id="preset-select-{{instance.pk}}">
                        <option value="">Presets</option>
                        ${ data.presets.map(include('#variation-preset')) }
                    </select>
                </label>
            </div>

            <div class="@2-x3">
                <label class="font-12">Stylistic Sets</label>
                <div class="controls-flex flex">
                    ${ data.features.map(include('#variation-feature')) }
                </div>
            </div-->
        </form>

        <div class="buttons-block block">
            <label class="{{instance.color_id}}-bg pill-button select-button button" for="select-pw-{{instance.pk}}">
                <select class="location-select" id="select-pw-{{instance.pk}}">
                    <option value="variable-1">Variable 1</option>
                    <option value="variable-2">Variable 2</option>
                </select>
            </label>
        </div>

        ${
            events('input', element)
            .filter((e) => e.target.id === 'select-pw-{{instance.pk}}')
            .each((e) => {
                const value = e.target.value;
                const variable = window.variables[value];
                assign(data, variable);
            }), ''
        }
    </template>
</head>

<body>
    <include-literal src="#variation-controls" id="controls">
        Default
    </include-literal>

    <script type="module">
    import '../form-elements/y-input/module.js';
    import '../form-elements/range-input/module.js';
    import './elements/include-literal.js';

    window.variables = {
        'variable-1': {
            settings: [{
                label: 'Arse',
                name: 'arse',
                min: 0,
                max: 200,
                default: 100
            }, {
                label: 'Weight',
                name: 'wght',
                min: 100,
                max: 800,
                default: 400
            }],

            features: [{
                label: '1',
                name: 'onum'
            }, {
                label: '2',
                name: 'desc'
            }],

            presets: [{
                id:    'preset-1',
                label: 'Preset 1',
                settings: {
                    'arse': 30,
                    'wght': 600
                }
            }, {
                id:    'preset-2',
                label: 'Preset 2',
                settings: {
                    'arse': 190,
                    'wght': 200
                }
            }]
        },

        'variable-2': {
            settings: [{
                label: 'Pooh',
                name: 'pooh',
                min: 10,
                max: 90,
                default: 20
            }, {
                label: 'Weight',
                name: 'wght',
                min: 100,
                max: 600,
                default: 300
            }],

            features: [{
                label: '1',
                name: 'onum'
            }, {
                label: '2',
                name: 'desc'
            }],

            presets: [{
                id:    'preset-1',
                label: 'Preset 1',
                settings: {
                    'arse': 30,
                    'wght': 600
                }
            }, {
                id:    'preset-2',
                label: 'Preset 2',
                settings: {
                    'arse': 90,
                    'wght': 200
                }
            }]
        }
    };

    const element = document.getElementById('controls');
    element.data = Object.assign({}, window.variables['variable-1']);
    </script>
</body>
