<head>
    <meta charset="utf-8" />
    <meta name="author" content="Stephen" />
    <meta name="description" content="Documentation for Literal. Literal puts JS into your HTML. Literal defines a custom include element that parses and renders templates written as JS Literals, in a small library under 15kB minified and gzipped." />
    <meta name="viewport" content="width=device-width" />

    <link rel="stylesheet" href="./element.css" />

    <script>
        window.DEBUG = true;
    </script>

    <style>
        .block {
            display: block;
        }

        [data-before]::before {
            content: attr(data-before);
        }

        .class-before::before {
            content: attr(class);
        }

        :not(:checked) + .unchecked-before::before {
            content: '✔ Input is unchecked'
        }

        :checked + .checked-before::before {
            content: '✔ Input is checked'
        }
    </style>

    <template id="attributes" data-checked>
        <pre data-before="${ data.attribute }"></pre>
        <pre class="class-before ${ data.class }"></pre>
        <pre hidden="${ data.boolean }">✔ Boolean is false</pre>
        <input type="text" value="${ data.value }" />
        <input type="checkbox" checked="${ checked }" />
        <pre class="unchecked-before"></pre>
        <pre>${ data.text }<br/>${ data.node }<br/>${ data.fragment }</pre>
    </template>

    <template id="stream">
        <pre hidden="${ data.stream }">✔ Stream of booleans is rendered (if this is flashing)</pre>
        <!--pre hidden="${ data.nope }">✔ Should be permanently shown</pre-->
    </template>

    <template id="includee">
        <pre>✔ Template included</pre>
    </template>

    <template id="includer">
        ${ include('#includee', data) }
    </template>

    <template id="item">
        <pre>${ this.constructor.name } - ${ data.label }</pre>
    </template>

    <template id="item-list">
        <h3>Test</h3>
        ${ data.items.map(include('#item')) }
    </template>

    <template id="test">
        <pre>${ data.one === 'One' ? '✔' : '' } ${ data.one }
${ data.two === 'Two' ? '✔' : '' } ${ data.two }
${ data.three === 'Three' ? '✔' : '' } ${ data.three }</pre>
    </template>
</head>

<body>
    <!--section title="Values">
        <h3 class="text-03">Values <span class="test-count">(1 test)</span></h3>

        <template id="values-template">
            <p>This is how various values are rendered in a <code>&lt;template&gt;</code>:</p>
            <dl style="display: grid; grid-template-columns: min-content 1fr; text-align: left;">
                <dt>String</dt>    <dd>${ 'hello' }</dd>
                <dt>Number</dt>    <dd>${ 123.45 }</dd>
                <dt>Infinity</dt>  <dd>${ Infinity }, ${ -Infinity }</dd>
                <dt>boolean</dt>   <dd>${ true }, ${ false }</dd>
                <dt>function</dt>  <dd>${ function fn(param) {} }</dd>
                <dt>arrow</dt>     <dd>${ (param) => {} }</dd>
                <dt>array</dt>     <dd>${ [0, 1, 2, 3] }</dd>
                <dt>object</dt>    <dd>${ { property: 'hello' } }</dd>
                <dt>NaN</dt>       <dd>${ NaN }</dd>
                <dt>null</dt>      <dd>${ null }</dd>
                <dt>symbol</dt>    <dd>${ Symbol('symbol') }</dd>
                <dt>undefined</dt> <dd>${ undefined }</dd>
            </dl>

            <p>Boolean attributes:</p>
            <p hidden="${ true }">❌ This paragraph has <code>hidden</code></p>
            <p hidden="${ false }">✓ This paragraph does not have <code>hidden</code></p>

            <p>Class attributes (TokenLists):</p>
            <p class="${ 'blue-fg' }">This paragraph has <code>class="blue-fg"</code>.</p>

            <p>Style attributes:</p>
            <p style="color: ${ 'blue' };">This paragraph has <code>style="color: blue;"</code>.</p>

            <p>Text attributes:</p>
            <p title="${ '✓ title attribute has literal content' }">This paragraph has a <code>title</code> attribute.</p>

            <p>Data attributes:</p>
            <p data-thing="${ '✓ data-thing attribute has literal content' }">This paragraph has a <code>data-thing</code> attribute.</p>

            <p>Value property:</p>
            <input type="text" value="${ 'hello' }" />
            <input type="number" value="  ${ 5 } " />
        </template>

        <include-literal src="#values-template" data='{ "a": 4 }'></include-literal>

        <hr/>
    </section-->

    <section title="Loading">
        <h3 class="text-03">Loading <span class="test-count">(4 tests)</span></h3>
        <include-literal src="#test" id="data-never">
            <pre>✔ Default content</pre>
        </include-literal>
        <include-literal src="#test" data="./test/test.json"></include-literal>
        <include-literal src="#test" data-one="One" data-two="Two" data-three="Three"></include-literal>
        <include-literal src="#test" data-one="./test/test.json" data-two="./test/test.json"></include-literal>
        <include-literal src="#test" data="./test/test-bad.json"></include-literal>
        <include-literal src="#test" id="data-later"></include-literal>
    </section>

    <!--section title="Binding">
        <h3 class="text-03">Live binding <span class="test-count">(4 tests)</span></h3>

        <template id="clock-template">
            <p>Time since load: ${ parseInt(data.time, 10) }</p>
        </template>

        <include-literal src="#clock-template" data="./test/test-clock.js"></include-literal>

        <hr/>

        <include-literal src="#clock-template" data="./test/test-clock.js"></include-literal>

        <hr/>

        <template id="even-template">
            <p>Even: ${ parseInt(data.time, 10) }</p>
        </template>

        <template id="odd-template">
            <p>Odd:  ${ parseInt(data.time, 10) }</p>
        </template>

        <template id="evenodd-template">
            ${ include(parseInt(data.time, 10) % 2 === 0 ? '#even-template' : '#odd-template', data) }
        </template>

        <include-literal src="#evenodd-template" data="./test/test-clock.js"></include-literal>

        <hr/>

        <template id="numbers-template">
            <label class="block">Number</label>
            <input type="number" value="${ parseInt(data.time, 10) }" />

            <label class="block">Range</label>
            <input type="range" min="0" max="9" value="${ parseInt(data.time, 10) }" />

            <label class="block">Checked on odd</label>
            <input type="checkbox" checked="${ parseInt(data.time, 10) % 2 }" />

            <label class="block">Checked on 1</label>
            <input type="checkbox" checked="${ parseInt(data.time, 10) === 1 }" value="1" />

            <label class="block">Checked when equal to 0-9</label>
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 0 }" value="0" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 1 }" value="1" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 2 }" value="2" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 3 }" value="3" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 4 }" value="4" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 5 }" value="5" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 6 }" value="6" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 7 }" value="7" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 8 }" value="8" />
            <input type="radio" name="clock-radio" checked="${ parseInt(data.time, 10) === 9 }" value="9" />

            <label class="block">Selected when equal to value 0-9</label>
            <select value="${ parseInt(data.time, 10) }">
                <option value="0">Zero</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
                <option value="4">Four</option>
                <option value="5">Five</option>
                <option value="6">Six</option>
                <option value="7">Seven</option>
                <option value="8">Eight</option>
                <option value="9">Nine</option>
            </select>
        </template>

        <include-literal src="#numbers-template" data="./test/test-clock.js"></include-literal>

        <hr/>
    </section-->

    <script type="module">
    /*import './elements/include-literal.js';

    const data1 = {
        items: [{
            label: 'One'
        }, {
            label: 'Ting'
        }]
    };

    const data2 = {
        items: [{
            label: 'Two'
        }, {
            label: 'Tang'
        }]
    };

    const element = document.getElementById('element');
    const data = element.data = Object.assign({}, data1);

    setTimeout(() => {
        Object.assign(element.data, data2)
    }, 500);*/




    import tests        from "../fn/modules/test.js";
    import Renderer     from './modules/renderer.js';
    import { Observer } from '../fn/observer/observer.js';

    const keys = Object.keys;
/*
    tests('Renderer', function(test, log) {
        test("Renderer()", function(equals, done) {
            const expected = [
                'Hail ',
                'Hail Bob',
                'Hail Mike',
                'Hail Mary',
                'Hail Ceasar'
            ];

            // source, scope, parameters, consts, errorstring, fn
            const renderer = new Renderer('Hail ${ data.x ? data.a : data.b }', {}, {}, '', null, (string) =>
                equals(expected.shift(), string)
            );

            const data = Observer({});

            // Hail
            renderer
            .done(() => equals(0, expected.length))
            .push(data);

            Promise
            .resolve()
            .then(() => {
                // Test for keys being observed
                equals(['x', 'b'], keys(renderer.observers));

                // Hail Bob
                data.b = 'Does nothing becuase immediately followed by ...';
                data.b = 'Bob';
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'b'], keys(renderer.observers));

                // Hail Mike
                data.a = 'Mike';
                data.x = true;
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                // Hail Mary
                data.a = 'Mary';
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                // Hail Ceasar
                renderer.push({ x: true, a: 'Ceasar' });
            })
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                // Stop
                renderer.stop();
            })
            .then(() => {
                // Test for keys being observed
                equals([], keys(renderer.observers));

                // Causes error
                renderer.push({ x: false });
            })
            .catch((e) => {
                // Error received
                equals('Error', e.constructor.name);
            })
            .finally(done);
        }, 13);

/*
        test("Renderer() Allow recueing from renderer.push() inside template", function(equals, done) {
            const expected = [
                'Hail ',
                'Hail Mary'
            ];

            const renderer = new Renderer('Hail ${ data.x ? data.a : (this.push({ x: true, a: "Mary" })) }', {}, {}, '', null, (string) =>
                equals(expected.shift(), string)
            );

            const data = Observer({ a: 'Mary' });

            // Hail
            renderer
            .done(() => equals(0, expected.length))
            .push(data);

            Promise
            .resolve()
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));

                renderer.stop();
            })
            .finally(done);
        }, 4);
*/
/*
        test("Renderer() Allow recueing from data.prop = x inside template", function(equals, done) {
            const expected = [
                'Hail true',
                'Hail Mary'
            ];

            const renderer = new Renderer('Hail ${ data.x ? data.a : (data.x = true) }', {}, {}, '', null, (string) =>
                equals(expected.shift(), string)
            );

            const data = Observer({ a: 'Mary' });

            // Hail
            renderer
            .done(() => equals(0, expected.length))
            .push(data);

            Promise
            .resolve()
            .then(() => {
                // Test for keys being observed
                equals(['x', 'a'], keys(renderer.observers));
                renderer.stop();
            })
            .finally(done);
        }, 4);
    });


    import create           from '../dom/modules/create.js';
    import Stream           from '../fn/modules/stream.js';
    import IntervalStream   from '../fn/modules/stream/interval-stream.js';
    import TemplateRenderer from './modules/renderer-template.js';

    tests('TemplateRenderer', function(test, log) {
        test("TemplateRenderer() primitive properties", function(equals, done) {
            const template = document.getElementById('attributes');
            const renderer = new TemplateRenderer(template, document.body);
            const data = {
                attribute: '✔ Attribute is rendered',
                class:     '✔ Class is rendered',
                boolean:   false,
                value:     '✔ Value is rendered',
                checked:   false,
                text:      '✔ Text is rendered',
                node:      create('text', '✔ Text node is rendered'),
                fragment:  create('fragment', '✔ Fragment is rendered')
            };

            renderer.push(data);
            document.body.append(renderer.first);
            done();
        }, 0);

        test("TemplateRenderer() include", function(equals, done) {
            const template = document.getElementById('includer');
            const renderer = new TemplateRenderer(template, document.body);
            const data = {};
            renderer.push(data);
            document.body.append(renderer.first);
            done();
        });

        test("TemplateRenderer() looped include", function(equals, done) {
            const template = document.getElementById('item-list');
            const renderer = new TemplateRenderer(template, document.body);
            const data = { items: [{ label: 'one' }, { label: 'two' }, { label: 'three' }] };
            renderer.push(data);
            document.body.append(renderer.first);
            done();
        });

        test("TemplateRenderer() stream property", function(equals, done) {
            const template = document.getElementById('stream');
            const renderer = new TemplateRenderer(template, document.body);
            const data = { stream: (new IntervalStream(0.4)).scan((value) => !value) };
            renderer.push(data);
            document.body.append(renderer.first);
            done();
        }, 0);
    });
*/

    import './element.js';

    const literal = document.getElementById('data-later');
    literal.data = { one: '✔ One', two: '✔ Two', three: '✔ Three' };
    </script>
</body>
